(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{"0290":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login-wrap"},[n("div",{staticClass:"box"},[n("div",{staticClass:"ms-title"},[e._v("智能系统软件测试数据生成平台")]),n("el-form",{ref:"loginFormRef",staticClass:"ms-content",attrs:{model:e.loginForm,rules:e.loginFormRules,"label-width":"0px"}},[n("el-form-item",{attrs:{prop:"username"}},[n("el-input",{attrs:{placeholder:"username"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}},[n("el-button",{attrs:{slot:"prepend",icon:"el-icon-lx-people"},slot:"prepend"})],1)],1),n("el-form-item",{attrs:{prop:"password"}},[n("el-input",{attrs:{type:"password",placeholder:"password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm()}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}},[n("el-button",{attrs:{slot:"prepend",icon:"el-icon-lx-lock"},slot:"prepend"})],1)],1),n("div",{staticClass:"login-btn"},[n("el-button",{attrs:{type:"primary",loading:e.loading,"element-loading-spinner":"el-icon-loading","element-loading-text":"登录中"},on:{click:function(t){return e.submitForm()}}},[e._v("登录")])],1),n("p",{staticClass:"login-tips"},[e._v("Tips : 本系统暂未开放注册功能。")])],1)],1)])},s=[],i=(n("96cf"),n("1da1")),r=n("4328"),a=n.n(r),l=n("5118"),c={inject:["reload"],data:function(){return{loginForm:{username:"",password:""},loginFormRules:{username:[{required:!0,message:"账号不可为空",trigger:"blur"}],password:[{required:!0,message:"密码不可为空",trigger:"blur"}]},loading:!1,flag:!0,lastTime:(new Date).getTime(),currentTime:(new Date).getTime(),timeOut:1e4,last_time_upgrade:!0}},mounted:function(){this.timer=Object(l["setInterval"])(function(){var e=this;if(this.currentTime=(new Date).getTime(),1==this.last_time_upgrade&&(this.lastTime=(new Date).getTime()),console.log("当前时间：",e.currentTime),console.log("上次时间：",e.lastTime),console.log("已过时间：",this.currentTime-this.lastTime),console.log("this.last_time_upgrade:",this.last_time_upgrade),console.log("this.loading:",this.loading),this.currentTime-this.lastTime>this.timeOut)return console.log("超时"),this.last_time_upgrade=!0,this.loading=!1,this.flag,this.reload(),this.$message.error("登录超时,请检查网络并刷新")}.bind(this),5e3)},beforeDestroy:function(){Object(l["clearInterval"])(this.timer)},methods:{cancelRequest:function(){"function"===typeof this.source&&this.source("终止请求")},submitForm:function(){var e=this,t=this,n=this.$http.CancelToken;n.source();this.loading=!0,console.log("this.loading",this.loading),this.$refs.loginFormRef.validate(function(){var n=Object(i["a"])(regeneratorRuntime.mark((function n(o){var s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("this.loginFormRules:"),console.log(e.loginFormRules),!o){n.next=39;break}if(console.log(e.loginForm),!0!==e.flag){n.next=39;break}return e.flag=!1,e.last_time_upgrade=!1,console.log("开始计时"),e.cancelRequest(),console.log("取消请求"),n.next=12,e.$http.post("/user/login/",a.a.stringify(e.loginForm),{cancelToken:new e.$http.CancelToken((function(e){t.source=e}))});case 12:if(s=n.sent,i=s.data,console.log("login-data"),console.log(i),2e4===i.code){n.next=25;break}return console.log(i.code),e.loginForm.password="",e.loading=!1,e.last_time_upgrade=!0,e.loading=!1,n.abrupt("return",e.$message.error("登录失败,请检查用户名或密码是否正确"));case 25:e.$store.commit("setToken",null),console.log("$store.token已清除"),window.sessionStorage.setItem("username",e.loginForm.username),window.sessionStorage.setItem("password",e.loginForm.password),e.$store.commit("setUserId",i.data.profile.id),console.log("this.$store.state.userId"+e.$store.state.userId),e.$store.commit("setToken",i.data.token),e.$store.commit("setUser_group_name",i.data.profile.user_group_name),e.getUserRight(),e.$message.success("登录成功"),console.log("data.data.token:",i.data.token),e.$router.push("/dashboard"),e.loading=!1,e.flag=!0;case 39:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},getUserRight:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get("/user/");case 2:t=e.sent,n=t.data,console.log("getUserRight-user1:"),console.log(n),this.$store.commit("setNickName",n.data.nickname),console.log("window.sessionStorage.getItem('nickname'):"+window.sessionStorage.getItem("nickname")),console.log("this.$store.state.token:"+this.$store.state.token),console.log("this.$store.state.nickname:"+this.$store.state.nickname),console.log(window.sessionStorage.getItem("user_group_name")+n.data.username);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},u=c,m=(n("297b"),n("2877")),d=Object(m["a"])(u,o,s,!1,null,"7900e384",null);t["default"]=d.exports},"1da1":function(e,t,n){"use strict";function o(e,t,n,o,s,i,r){try{var a=e[i](r),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(o,s)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(s,i){var r=e.apply(t,n);function a(e){o(r,s,i,a,l,"next",e)}function l(e){o(r,s,i,a,l,"throw",e)}a(void 0)}))}}n.d(t,"a",(function(){return s}))},"297b":function(e,t,n){"use strict";n("7545")},5118:function(e,t,n){(function(e){var o="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,s=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(s.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new i(s.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n("6017"),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("c8ba"))},6017:function(e,t,n){(function(e,t){(function(e,n){"use strict";if(!e.setImmediate){var o,s=1,i={},r=!1,a=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?g():f()?p():e.MessageChannel?h():a&&"onreadystatechange"in a.createElement("script")?v():w(),l.setImmediate=c,l.clearImmediate=u}function c(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return i[s]=r,o(s),s++}function u(e){delete i[e]}function m(e){var t=e.callback,o=e.args;switch(o.length){case 0:t();break;case 1:t(o[0]);break;case 2:t(o[0],o[1]);break;case 3:t(o[0],o[1],o[2]);break;default:t.apply(n,o);break}}function d(e){if(r)setTimeout(d,0,e);else{var t=i[e];if(t){r=!0;try{m(t)}finally{u(e),r=!1}}}}function g(){o=function(e){t.nextTick((function(){d(e)}))}}function f(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function p(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&d(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),o=function(n){e.postMessage(t+n,"*")}}function h(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;d(t)},o=function(t){e.port2.postMessage(t)}}function v(){var e=a.documentElement;o=function(t){var n=a.createElement("script");n.onreadystatechange=function(){d(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function w(){o=function(e){setTimeout(d,0,e)}}})("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,n("c8ba"),n("f28c"))},7545:function(e,t,n){}}]);